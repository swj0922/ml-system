<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>机器学习模型预测服务</title>
    <!-- 链接外部CSS样式表文件 -->
    <link rel="stylesheet" href="/static/styles.css">
    <!-- 添加Markdown解析库 -->
    <script src="https://cdn.jsdelivr.net/npm/marked@9.1.6/marked.min.js"></script>
</head>
<body>
    <h1>机器学习模型预测服务</h1>
    
    <div class="container">
        <h2>API信息</h2>
        <div class="api-info">
            <p><strong>服务状态:</strong> <span id="api-status">检查中...</span></p>
            <p><strong>API文档:</strong> <a href="/docs" target="_blank">Swagger UI</a></p>
            <p><strong>预测端点:</strong> <span class="api-endpoint">POST /predict</span></p>
            <p><strong>特征列表端点:</strong> <span class="api-endpoint">GET /features</span></p>
            <p><strong>随机样本端点:</strong> <span class="api-endpoint">GET /sample?count=1</span></p>
            <p><strong>SHAP分析端点:</strong> <span class="api-endpoint">POST /shap-with-stats-analysis</span></p>
        </div>
    </div>

    <div class="container">
        <h2>功能选择</h2>
        
        <div class="tab">
            <button class="tablinks active" onclick="openTab(event, 'random-sample')">随机样本预测</button>
            <button class="tablinks" onclick="openTab(event, 'manual-input')">手动输入预测</button>
            <button class="tablinks" onclick="openTab(event, 'shap-stats-analysis')">SHAP分析</button>
            <button class="tablinks" onclick="openTab(event, 'pdp-analysis')">部分依赖图</button>
        </div>
        
        <div id="random-sample" class="tabcontent" style="display: block;">
            <div class="input-group">
                <label for="sample-count">样本数量:</label>
                <input type="number" id="sample-count" min="1" max="10" value="1">
            </div>
            <button class="btn" onclick="getRandomSample()">获取随机样本</button>
            <button class="btn btn-success" onclick="predictRandomSample()">预测随机样本</button>
            
            <div id="random-sample-data"></div>
        </div>
        
        <div id="manual-input" class="tabcontent">
            <div id="feature-inputs"></div>
            <button class="btn btn-success" onclick="predictManualInput()">预测手动输入</button>
        </div>
        

        
        <div id="shap-stats-analysis" class="tabcontent">
            <div class="input-group">
                <label for="shap-stats-sample-count">样本数量:</label>
                <input type="number" id="shap-stats-sample-count" min="1" max="10" value="1">
            </div>
            
            <div class="input-group">
                <label for="llm-model-select">选择LLM模型:</label>
                <select id="llm-model-select" class="model-select">
                    <option value="gemini">Gemini</option>
                    <option value="qwen">Qwen</option>
                </select>
                <small class="model-description">
                    <span id="model-description-text">Gemini: Google的先进大语言模型，支持多语言和复杂推理</span>
                </small>
            </div>
            
            <button class="btn" onclick="getRandomSampleForShapStats()">获取随机样本</button>
            <button class="btn btn-success" onclick="analyzeRandomSampleWithStats()">分析随机样本</button>
            
            <div id="shap-stats-random-sample-data"></div>
            
            <h3>手动输入分析</h3>
            <div id="shap-stats-feature-inputs"></div>
            <button class="btn btn-success" onclick="analyzeManualInputWithStats()">分析手动输入</button>
            
            <div id="llm-interpretation-container"></div>
        </div>

        <div id="pdp-analysis" class="tabcontent">
            <h3>特征选择</h3>
            <div class="input-group">
                <label for="pdp-grid-resolution">网格分辨率:</label>
                <input type="number" id="pdp-grid-resolution" min="20" max="200" value="100">
                <small>控制PDP曲线的平滑度（20-200）</small>
            </div>
            
            <div class="feature-selection-container">
                <div class="feature-selection-header">
                    <h4>选择特征（最多9个）</h4>
                    <div class="feature-selection-controls">
                        <button class="btn btn-secondary" onclick="selectRandomFeatures()">随机选择特征</button>
                        <button class="btn btn-secondary" onclick="clearFeatureSelection()">清空选择</button>
                        <span id="selected-feature-count">已选择: 0/9</span>
                    </div>
                </div>
                <div id="feature-selection-list" class="feature-selection-list">
                    <!-- 特征选择列表将在这里动态生成 -->
                </div>
            </div>
            
            <div class="pdp-controls">
                <button class="btn btn-success" onclick="generatePDP()">生成部分依赖图</button>
                <button class="btn" onclick="getRandomSampleForPDP()">获取随机样本</button>
            </div>
            
            <div id="pdp-sample-data" class="sample-data-container">
                <!-- 随机样本数据将在这里显示 -->
            </div>
            
            <div id="pdp-results" class="pdp-results-container">
                <!-- PDP分析结果将在这里显示 -->
            </div>
        </div>
        
        <div class="loading" id="loading">
            <div class="spinner"></div>
            <p>正在处理请求...</p>
        </div>
        
        <div class="error-message" id="error-message"></div>
        
        <div id="prediction-results"></div>
    </div>
    <!-- JavaScript版本v=1 -->
    <script src="/static/script.js?v=1"></script>
</body>
</html>